13 мар, 2007
СОВМЕСТИМОСТЬ ВЕРСИЙ
-------------
Вопрос совместимости один из основных в разработке чего-либо... Да, запускать
программы под немизиду уже можно, НО в следующей версии может изменится адрес
загрузки програм и их нужно будет править и перекомпелировать. А это очень
примитивное, неудачное решение... нужно придумать такой способ загрузки програм,
что бы программы под одну ось были совместимы с этой осью, даже при выходе новых
версий оси, иначе нафиг такая ось кому надо?.. Следующий этап разработки:
продумать нормальный образ запуска, который не будет менятся с каждой новой
версией.
Posted at 19:31


12 мар, 2007
ЗАПУСК ПРОГРАМ
-------------
Сегодня я добавил ядерную функцию немизиды, пожалуй, одну из
основных ;) : запуск програм. Теперь под немизиду можно писать программы =)!!!
Для того что бы запустить программу нужно просто написать ее название, пока,
что только большими буквами :)... позже что-то подумаеш. Поскольку файловая
система FAT12 записывать файлы можно из-под выни. Кстати скоро выйдет
версия 0.0.1 :)!!! Она небудет супер-пупер осью :D, но уже будет работать
более-менее сносно, и вней можно будет что-то делать ;). Еще сегодня был
усовершенствован загрузчик немизиды, теперь ядру необязательно быть первым
в файловаой системе :). Список функций немизиды я через пару дней выложу.
Хочю заметить, что кодить под немизиду намного проще чем под Дос ;). Я делаю
все для того, что бы упростить жизнь кодэру =).
Posted at 20:41


11 мар, 2007
ИСПРАВЛЕНО =)!
-------------
Ура!!!!!!! Наконецто я раздуплился в чем была проблема... почему не запускался
sh3ll на живом компе и вмваре, дело в том, что сектора начинаются с 1, а
дорожки и головки с 0, борщю на это пох :), для него не имеет значения с чего
начинаются сектора с 0 или с 1... это породило здоровенную багу ;)! когда мне
нужно было обратится к 18-ому сектору, 1-ой головки, 0-й дорожки, я обращался
к 0-му сектору, 0-ой говолвки, 1-ой дорожки...(весь прикол в том, что дорожки
размещаются на дискете(и не только ;)) таким образом: 0-ая дорожка,
0-ая головка; 0-ая дорожка, 1-ая говлока;1-ая дорожка, 0-ая головка;
1 -ая дорожка, 1-ая головка... и т.д.) да наломали дров изобретатели борща...
самое интересное, что в версии 2.3 эта бага еще есть!!! я до этого пользовался
версией 2.2.1. Вот так, и с этой проблемой справились =)!!!
Метки: Исправлено =)!
Posted at 13:24


10 мар, 2007
ПРИЧИНА
-------------
В общем понял я в чем прикол был... не получалось прочитать с дискеты...
забавно... борщ читал... вмварь и реальный комп нет... Раздуплился крапаль
с защищенным режимом проца =). Теперь немизида будет не 16-ти разрядной,
однозадачной, а 32-битной многозадачной =). Только одно плохо, седня узнал,
прерывания биоса мне будут не доступны... придется ипатся с портами
ввода/вывода... а это геморойно... ладно пох, буду приводить в нормальный
вид немизиду, точнее загрузчик програм. В нем щас основаная проблема...
Метки: Причина
Posted at 21:59


9 мар, 2007
ОБЛОМ С ЗАГРУЗКАОЙ :(
-------------
Охренеть!!!! Седня запустил немизиду под вмварью... шел не запустился... капец,
чо за гониво, он должен был загрузится!!!! в борще загружается... и все в умате
пашет... "ну пох..." - подумал я, откопал дискетку, которая в пилы валялась в
коробке с дисками, записал на нее образ дискетки, но это было после того, как я
записал тоже на сд-рв, загрузился вмварью НИХРЕНА толкового, ни с дискеты, ни с
диска... облом в общем :(... потом я решил загрузить комп с дискеты, а потом с
диска... РЕЗУЛЬТАТ ТОТ ЖЕ: командный интерпретатор не запускается, сразу после
загрузки происходит перезагрузка компа, а на моем компе даже нема вывода
сообщений загрузчика и оси :(... буду искать выход...
Метки: Облом с загрузкаой :(
Posted at 12:51


8 мар, 2007
ЦВЕТ ТЕКCТА И ФОНА В КОНСОЛИ
-------------
Седня замутил удобную смену цвета текста и фона в консоли... как всегда ядерная
фунция... зато теперь себе ненадо рвать жопу и писать юзерское приложение для
того, что-бы изменить эти цвета. Смена производится как в виндовой консоли:
команда c0ns0le и два параметра, без пробела между ними( c0ns0le 02 - это чорный
фон, зеленые буквы(дэфолт :)). Проипался над этим... до хрена в общем часа 2 или
больше... хотя это фигня... просто мутится(я так думал ;)). Для начала добавил 2
переменные(угадай для чего :)). Потом написал прерывание для того, что бы оно
изменяло (подконтрольно - это основное ;)) те переменные. Щас сижу и думаю:
странное у меня ядро выходит... все крутится вокруг консоли... ну ничо...
пригодится ;)...
Posted at 18:37


7 мар, 2007
КОМАНДА D1R
-------------
Наконецто =)!!! В нашем шеле есть поддержка команды d1r. Уже можно просматривать сожержимое каталога ;). Конечно, это было как всегда геморойно :D, но ни чо прорвемся ;). Были бешеные траблы с выводом, формированием вывода(нужно добавлять перенос на новую строку :)), потом со стэком... из-за одного гона, выводились не переносы на новую строку, а... еще добавлялось левая фигня... это было из-за того, что я забыл ноль поставить после 2-ух переносов :D... Нашол новую "неточность": при нажатии на стрелочки: "вправо","влево","вниз","вверх"; они отображаются :)... надо будет исправить... d1r работает через функции ядра findfirst, которая находит файл, номер которого передается через ecx... кстати, очень неудачно она ищет ;)... это я седня написал тоже, плодовитый день седня, столько сделал :).
Метки: Команда d1r
Posted at 17:00 | Ссылка | Оставить комментарий | В избранное | Поделиться
БЭКСПЕЙС
Капец! Столько траблов с этим бэкспейсом!!! Вчера думал: все в умате, уже пашет :).
Так нет же. Если мы напишем сначала:"sdjflsjdjfs;ldjfs;ldjf", а потом все сотрем и напишем команду оболочки "h3lp", к примеру, нужный нам h3lp не выползет... ползет обнадеживающее сообщение "command not found o_O" ... да... охренеть... совсем не то, что мне нужно было... в чем же траблы, думал я чесал репу, и все это в тот момент, когда я реализовывал команду d1r :)...
В общем, выкупил я в чем прикол... я не выводил символ бэкспэйса, затирал на экране предыдущий символ... НО я не удалял его из масива :D!!! То есть у меня масив продолжал расти, в нем небыло бэкспэйсов, но из введенных были ВСЕ символы :D... да... кодинг оси не такая простая работа, как казалось ;), но ничо справимся =).
Метки: Бэкспейс


8 апр, 2007
ЧТЕНИЕ С НГМД
-------------
Седня раздуплился с чтинием с дискеты, используя порты ввода-вывода.
Геморойное, конечно, дело :), вчера весь день мануалы искал... но главное,
что справился и раздуплился :). Следующий этап пожалуй защищенный режим,
поскольку от биоса мы уже не зависим ;), можно делать что угодно =)!..
Творить чюдеса в общем.
Метки: Чтиние с нгмд
Posted at 22:08 


1 апр, 2007
FAT12...
-------------
Капец, блин. Вчера с бэкспэйсом ипался, врезультате чего загрузчик програм
пошол... не в ту сторону ;)... и командный интерпретатор не мог загрузится...
а все из-за кривости работы с fat12. Седня раздуплился и вроде написал что-то
более-менее стабильное-нормальное :). Теперь с бэкспейсом буду упражнятся,
щас он работает не просто плохо, а просто отвратительно...
лучше не нажимать ;)!..
Posted at 11:56 


31 мар, 2007
СКРОЛИНГ, КЛАВА...
-------------
Замутил уже нормальный скролинг, который сохраняет все регистры, с которыми
работает, исправил очистку последнего рядка, раньше она очищалась stosb'ом,
то есть на ah мы не обращали внимания... а в нем же вся суть!!! 
То есть цвета фона и текста! Из-за этого были траблы, такие как перенос
приглашиние шела на 23 символа в момент скрола. Долго не могу
понять: что происходит. Потом был гониво с тем, что я неизвестно зачем
инициализировал ds bx'ом перед stosb'ом. Теперь нулем инициализирую, и stosw'лю.
Нормально. Решил проблему стем, что написать команду типа "r3b00t", для
перезагрузки компа, нельзя было из-за того, что второй ноль не писался...
Сейчас уже все пишется. Замутил очистку экрана. И новую команду в шел. Переписал
функцию смены цвета фона и текста. Теперь она требует 10-ого прерывания биоса.
И меньше занимает :)! Теперь буду мутится с бэкспэйсом (опять :D!) и с портами
ввода-вывода для чтения с дискеты.
Posted at 10:31 


25 мар, 2007
ВНЕДРЕНИЕ ПОРТОВЫХ ФУНКЦИЙ В 16-И БИТНУЮ НЕМИЗИДУ
-------------
Седня пришла в голову интересная мысль!!! Не писать все с чистого листа,
я про 32-ух битную немизиду, а переписывать функции, стараясь максимально не
использовать биос. Седня переписал клаву =)! Получилось немного глючновато...
но уже работает... правда долго не мог понять: почему при проверке
<числа больше 56> и 56 большим оказывалось 56 и программа работала неверно :(!
Код: cmp bl,0x56/jg again ... долго не мог понять: что происходит!
Но позже придумал поменять cmp bl,0x56 на cmp bx,0x56 (bh=0), и подействовало!!!
Незнаю в чем прикол... тестил борщем и вмварью... но оно так :).
Posted at 22:41


24 мар, 2007
РЕАКЦИЯ НА КЛАВУ
-------------
Седня зделал до хрена что бы работала клава =)! Например: когда нажимаеш:"k" - 
видиш не "kkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkkk...", а одну "k" :D!
Пробел уже пашет... да и работать уже можно полюдски :). То есть и ввод и вывод
в 32-ух битной немизиде уже готов!!! Уже можно в умате висеть ;)!!! Дальше нужно
будет раздуплится с чтением секторов дискетки... да!.. тут гемороя будет
побольше ;)!
Posted at 14:27 


22 мар, 2007
ВВОД-ВЫВОД
-------------
Щас раздупляюсь с вводом и выводом текста :), вывод - это уже просто, а с
вводом проблемы... например пока, что нельзя ввести большие буквы, нельзя
поставить пробел и т.д. Все мутиться с помощью портов ввода-вывода, с которыми
до хрена проблем... замутить обработку всех клавиш в ближайшее время
не получится... но поддержкой основных(буквенно-циферных) буду работать =)!
Posted at 21:40 


18 мар, 2007
СКРОЛИНГ
-------------
Седня замутил грамотный скролинг :), в 16-битной немизиде можно было
воспользоватся вводом-выводом... так нет, в 32-ух битном нельзя... можно только
писать по адресу 0xb8000... ну ничо справился :), очередная задача решена :).
Дальше с клавой буду работать и с установкой прерываний.
Posted at 21:16 


17 мар, 2007
ФУНКЦИЯ ВЫВОДА
-------------
Сегодня замутил функцию вывода, используя порты ввода-вывода =)!!! Сейчас для
меня использование прерываний Биоса не допустимая розкош... Высокоуровневые апи,
так сказать :D... Начинаю работать 32-битном режиме уже замутил загрузчик,
который здоровается ;), при этом не использовал ни одного прерывания, облазил
пол инэта... капец :)... зато можно без напрягов использовать 32-ух битные
регитры, не боясь, что места мало... во-первых потому, что не будет этой
дурацкой приставки 0x66 (в 16-битных будет ;)), во-вторых потому, что в
нашем распоряжении будет 4гб =)!!! Тут можно хоть по десять байт добавлять ;)!!!
Posted at 20:21 


СЕГМЕНТНЫЕ РЕГИСТРЫ...
-------------
Блин... Не могу понять: как с ними по людски работать? Если на них забить и
использовать то, что мы имеем в момент загрузки, сразу после биоса ( ds=0), то
будет доступно только 64кб из 1-ого доступного нам мб... ну мб - это конечно,
не вся используемая оператива ;), но все же для програмок написаных под
немизиду, ранней стадии разработки, вполне хватает, НО это гониво, если
использовать то, что имеем, а имеем мы: адрес загрузки всех програм начинается
с 0xa000... адрес загрузки загрузчика 0x7c00, ядра немизиды - 0x7e00 (ну это
можно исправить, ядро перекомпилить проще всего ;)), поскольку загрузчик весит
0x200 байт. на ядро если выделить 8.5 кб, то на весь варез остается 24кб...
это полнейший бред, с которым нужно боротся!!! во-первых если ядро будет
больше 8.5 кб(а оно будет ;)!), то придется менят адрес загрузки програм,
при этом максимальный размер програм будет уменьшатся... и их нужно будет
ВСЕ перекомпелирывать( конечно, это щас звучит смешно... но нужно правильно
проэктировать, что бы можно было хотя бы ПИСАТЬ под немизиду варез). Проблема
сегментных регистров заключается в том, что если у ядра будет 64 кб(это
уже норм ;)), и у каждой програмы будет 64кб, то когда программа будет вызывать
функции немизиды (типа вывод на скрин), которым передаются данные (типа адрес
строки) - эти данные будут выщитыватся относительно сегментного регистра
немизиды, а там ЭТИХ данных НЕТ... есть какой-то мусор... так вот, щас буду
заниматся тем, что бы можно было из обычной программы вызывать функции немизиды,
при этом без гемороя, и что-бы начальный адрес загрузки програм был 0x0000 - это
на будущее, для совместимости ;)!
Posted at 11:32 


15 мар, 2007
ЗАЩЕЩЕННЫЙ РЕЖИМ
-------------
Разбираюсь щас с защищенным режимом... капец... тежолый он... заинтересоватся
заставило то, что с сегментными регистрами я не представляю как работать, так
что бы полюдски все было... как у людей :D... читал седня интеловый мануал...
охренеть один сорец на все книгу!!! Я чуть с ума не сошел...
нахрена столько теории??? сначала должна быть практика!!! А потом(или в ней)
обьяснятся все, что исполозуется... имхо, так гораздо проще... хотя бы потому,
что никому ненужно знать сразу ВСЕ о предмете, все изучается постепенно...
и желательно с практикой( без практики обречено на вылетание из головы ;))...
буду раздуплятся постепенно, и переписывать немизиду на новый лад :). Еще узнал
как можно выводить на консоль не используя прерывания биос :)!!! Это очень
удобно ;), хотя крапаль сложнее(нужно писать в видео память).

Философия немизиды.
-------------
Первое, и самое главное: программирование на ассемблере - достойное хобби.
Ничего сложного в кодинге на асме нет. Сложных вещей не существует
(©mn3m0n1c 3n3m1) - при правильном подходе ;)! Так вот: немизида кодится при
правильном подходе. Поэтому ВСЕ, вмеру возможности, будет реализовано.
И создается она, как и линух в свое время ;), для кодэров на
АССЕМБЛЕРЕ(в линухе был ЦЭ, вот :)...).  Второе - это МОРДА.
Взаимодействие между пользователем и немизидой должно быть максимально простым,
то есть пользователь должен видеть, что происходить с осью ВСЕ ВРЕМЯ.
То есть, все же не только для кодэров пишем ;)!  Третье - молодежный стиль морды,
НЕ НАУЧНЫЙ, а МОЛОДЕЖНЫЙ. Мы не действуем по определенным принципам, даже если
это считается многими идеальным( посикс... сори надоело уже!). Мы создаем
удобное и идеальное для себя, возможно это придется вам по вкусу, НЕ ФАКТ,
то также не факт, что если мы сделаем все как у всех, вы перейдете на нас
(этого не будет, и не надо!!! от нубов - для нубов... от избранных - ...
понятно? ;)).  Еще одно. Возраст не имеет значения. Звание професор не о чем
не говорит, мало кто из професоров разбирается в ассемблере,
имхо(не одного не встеречал :)...). Поэтому, 5 вам лет или 75 вы имеет равные
права и привилегии. Надеюсь я все изложим максимально четко... если чо-то плохо
написал спрашивайте. Можно в коментах ;).

Основы кодинга под немизиду
-------------
Первое, что я хочю сказать про Немизиду, это то, что она создана для кодэров
на асме( от нуболв - для нубов =)!). Поэтому из уважения к себе подобным я
создаю и встраиваю в ядро все самое основное, для того, что бы программист
чувствовал себя комфортно, даже того более, по некоторым параметрам мои функции
намного удобнее чем в были в Dos'e.  Итак, в данный момент времени немизида
16-и битная, но это не надолго ;)! В ближайшее время она будет 32-ух битной и
работать соответственно в защищенном режиме. Функционал от этого не обеднеет, и
программы не придется переписывать с нуля!  Апи немизиды размещаются в 0xff
прерывании. То есть для того, что бы вызвать какую-либо функцию нужно положить
в al, ее номер, заполнить все параметры и вызвать прерывание 0xff.
Видите как все просто =)!  Вот таблица функций, которые уже существуют
и более-менее работают ;):

```asm
_reboot             equ   0 
_get_char           equ   1 
_printf             equ   2 
_find_file	        equ   3 
_exec               equ   4 
_find_first	        equ   5 
_color	            equ   6 
_setcursor	        equ   7 
_gets               equ   8 
_cls                equ   9 
_getcursor          equ   0xa 
_setminmaxcolline   equ   0xb
```
Для удобства кодинга советую создать инклуд и с этой информацие и вставить ее в
свой сорец. Слово "equ" означает синоним(эквивалент), это значит, что для того,
что бы вывести что-либо на экран достаточно написать:

```asm
mov al,_printf 
mov bx,data 
int 0xff 
data db 'h3ll0 w0rld =)!',0
```

Фасм ( а я рекомендую юзать фасм, поскольку он лучший, и именно на нем я пишу
немизиду :)!) заменит _printf на 2. Это горазда проще чем запоминать номера,
правда? Для остальных функций все аналогично. Вот минимальная прога, которая
бы использовала все функции немизиды.

```asm
;start_offset equ здесь мутим адрес, скоторого будет начинатся наша прога. 
include 'sysint.inc' обьявление констант, что бы не переписывать ;). 
use16

xor al,al;перезагрузка компа 
int 0xff

mov al,_printf ;выводим приветствие 
mob bx,hi 
int 0xff

mov al,_find_file ;ищет определенный файл 
mov bx,file_name ;имя файла 
int 0xff

mov al,_exec 
mov bx,file_name; запускает программу 
int 0xff

xor bx,bx 
_find_next: 
mov al,_find_first 
int 0xff 
or al,al 
jz _end 
inc bx 
mov si,ax 
mov di,file_name 
call strcmp; функция которая сравнивает строки нужна 
jmp _find_next 
_end:

mov al,_color 
mov cl,[textcolor] 
mov ch,[bgcolor] 
int 0xff

mov al,_setcursor 
mov bl,[col] 
mov bh,[line] 
int 0xff

mov al,_gets 
mov cx,maxbuffer 
mov bx,buffer 
int 0xff

mov al,_cls 
int 0xff

mov al,_getcursor 
int 0xff 
;в al столбик 
;в ah рядок

mov al,_setminmaxcolline ;устанавливаем границы экрана для записи 
mov bl,[mincol] ;ядерными функциями 
mov cl,[maxcol] 
mov bh,[minline] 
mov ch,[maxline] 
int 0xff

;дальше нужно обьявить все переменные...
```
